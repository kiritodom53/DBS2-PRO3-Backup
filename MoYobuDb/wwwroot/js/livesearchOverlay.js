$(document).ready(function () {
  $('.search').click(function () {
    $('.search-background').css('visibility','visible')
  });
  $('.exit').click(function () {
    $('.search-background').css('visibility','hidden')
  });
  let temp =
    '{"animes":[{"animeId":104372,"romajiTitle":"Yeonae Haru Jeon 3","japaneseTitle":"\\uc5f0\\uc560\\ud558\\ub8e8\\uc8043","englishTitle":"A Day Before Us 3rd Season","description":"3rd season of A Day Before Us.","coverImage":"https:\\/\\/s4.anilist.co\\/file\\/anilistcdn\\/media\\/anime\\/cover\\/small\\/nx104372-7PC0VgQefrht.jpg","format":"ONA","episodes":18,"episodeDuration":3,"status":"FINISHED","startDate":"2018-10-05T00:00:00","endDate":"2019-02-01T00:00:00","season":" ","averageScore":62,"source":"ORIGINAL","hashtag":null,"anilistId":null,"malId":null,"studioId":null,"studio":null,"episodesThreadId":null,"episodesThread":null,"reviewsThreadId":null,"reviewsThread":null,"animeCharacters":null,"characters":null,"animeGenres":null,"animeLists":null,"animeStaffs":null,"animeTags":null},{"animeId":9951,"romajiTitle":"Jiu Se Lu","japaneseTitle":"\\u4e5d\\u8272\\u9e7f","englishTitle":"A Deer of Nine Colors","description":"In ancient times, a Persian merchant gets lost in a windstorm. Suddenly a spiritual deer of nine colors appears to guide the man. Later on, the deer rescues a man drowning in a river. In exchange, the man promises not to reveal the deer\'s whereabouts. The man reaches an imperial palace. The king insists on hunting down the spiritual deer down to make clothes out of the deer skin. The man gives in to his greed and leads an army of warriors to the spot. He falls into the river again, hoping the deer will show up to rescue him. This time, all the warriors\' arrows turn into dust and the man is drowned.<br><br>\\n(Source: Wikipedia)","coverImage":"https:\\/\\/s4.anilist.co\\/file\\/anilistcdn\\/media\\/anime\\/cover\\/small\\/9951.jpg","format":"MOVIE","episodes":1,"episodeDuration":26,"status":"FINISHED","startDate":null,"endDate":null,"season":null,"averageScore":0,"source":null,"hashtag":null,"anilistId":null,"malId":null,"studioId":null,"studio":null,"episodesThreadId":null,"episodesThread":null,"reviewsThreadId":null,"reviewsThread":null,"animeCharacters":null,"characters":null,"animeGenres":null,"animeLists":null,"animeStaffs":null,"animeTags":null},{"animeId":104936,"romajiTitle":"Boku no Tonari ni Ankoku Hakaishin ga Imasu.","japaneseTitle":"\\u307c\\u304f\\u306e\\u3068\\u306a\\u308a\\u306b\\u6697\\u9ed2\\u7834\\u58ca\\u795e\\u304c\\u3044\\u307e\\u3059\\u3002","englishTitle":"A Destructive God Sits Next to Me","description":"Seri Koyuki is just trying to have a normal school life, but instead he ends up acting as the straight man to his odd classmate, Kabuto Hanadori. Kabuto is is a delusional high school student, whose fantasies range from believing he is a knight on a journey, to claiming that removing his eyepatch will release a darker alter-ego who he refers to as Michael Offenbarung Dunkelheit. Seri is determined not to let himself get pushed around by Kabuto, but it seems that this will be easier said than done!","coverImage":"https:\\/\\/s4.anilist.co\\/file\\/anilistcdn\\/media\\/anime\\/cover\\/small\\/bx104936-pj2LwAKTPZ4u.png","format":"TV","episodes":12,"episodeDuration":24,"status":"FINISHED","startDate":"2020-01-11T00:00:00","endDate":"2020-03-28T00:00:00","season":"WINTER 2020","averageScore":58,"source":"MANGA","hashtag":"#bokuhaka #\\u307c\\u304f\\u306f\\u304b","anilistId":104936,"malId":38302,"studioId":6125,"studio":null,"episodesThreadId":null,"episodesThread":null,"reviewsThreadId":null,"reviewsThread":null,"animeCharacters":null,"characters":null,"animeGenres":null,"animeLists":null,"animeStaffs":null,"animeTags":null},{"animeId":2624,"romajiTitle":"Flanders no Inu, Boku no Patrasche","japaneseTitle":"\\u30d5\\u30e9\\u30f3\\u30c0\\u30fc\\u30b9\\u306e\\u72ac\\u3000\\uff5e\\u307c\\u304f\\u306e\\u30d1\\u30c8\\u30e9\\u30c3\\u30b7\\u30e5\\uff5e","englishTitle":"A Dog of Flanders: My Patrasche","description":"A boy named Nello becomes an orphan at the age of two when his mother dies.  His grandfather, who lives in a small village takes him in. One day, Nello finds a dog who was almost beaten to death and named him Patrasche. Due to the good care of his grandfather, the dog recovers, and from then on, Nello and Patrasche are inseparable. Since they are very poor, Nello has to help his grandfather by selling milk. Patrasche helps him pull the milk cart that Nello uses to sell milk in the town.<br><br>\\n(Source: Wikipedia)","coverImage":"https:\\/\\/s4.anilist.co\\/file\\/anilistcdn\\/media\\/anime\\/cover\\/small\\/2624.jpg","format":"TV","episodes":26,"episodeDuration":25,"status":"FINISHED","startDate":"1992-10-10T00:00:00","endDate":"1993-03-27T00:00:00","season":"FALL 1992","averageScore":0,"source":null,"hashtag":null,"anilistId":null,"malId":null,"studioId":null,"studio":null,"episodesThreadId":null,"episodesThread":null,"reviewsThreadId":null,"reviewsThread":null,"animeCharacters":null,"characters":null,"animeGenres":null,"animeLists":null,"animeStaffs":null,"animeTags":null},{"animeId":6273,"romajiTitle":"Tsuyu no Hitoshizuku","japaneseTitle":"\\u3064\\u3086\\u306e\\u3072\\u3068\\u3057\\u305a\\u304f\\uff5e\\u300c\\u690d\\u7530\\u6b63\\u6cbb\\u300d\\u306e\\u5199\\u771f\\u4e16\\u754c\\u3092\\u5f77\\u5fa8\\u3046\\uff5e","englishTitle":"A drop of dew","description":"Working since before WW2, UEDA Shoji pierced through amateurism, Then, in his picture world he takes, cuts and rearranges photos through his own sensibility, which takes him to the new media that is Ga-nime, encouraged by his friend the actor SANO Shiro, born in the same prefecture. The pictures used for this exhibition are not only from his most famous \u201CDune Mode\u201D series, but also of many pre\\/post-war pictures of his birthplace, streetcars running in Tokyo, and traditional scene of Japan, through which a whole culture appears. Source: Toei-anim.co.jp","coverImage":"https:\\/\\/s4.anilist.co\\/file\\/anilistcdn\\/media\\/anime\\/cover\\/small\\/6273.jpg","format":"OVA","episodes":1,"episodeDuration":36,"status":"FINISHED","startDate":"2006-08-01T00:00:00","endDate":"2006-08-01T00:00:00","season":"SUMMER 2006","averageScore":0,"source":null,"hashtag":null,"anilistId":null,"malId":null,"studioId":null,"studio":null,"episodesThreadId":null,"episodesThread":null,"reviewsThreadId":null,"reviewsThread":null,"animeCharacters":null,"characters":null,"animeGenres":null,"animeLists":null,"animeStaffs":null,"animeTags":null},{"animeId":17677,"romajiTitle":"Buki yo Saraba","japaneseTitle":"\\u6b66\\u5668\\u3088\\u3055\\u3089\\u3070","englishTitle":"A Farewell to Weapons","description":"Based on a story by Otomo (Katsuhiro), it\'s about a ragtag group of hard-talkin\', power suit-wearin\' men tasked with disarming automatic tanks in a post-apocalyptic Tokyo.<br>\\n<br>\\n(Source: Crunchyroll)<br>\\n<br>\\nThis movie is part of Otomo Katsuhiro\'s omnibus project \\\\\\"Short Peace\\\\\\" (Hi no Youjin, Tsukumo, Gambo and Buki yo Saraba).<br>\\n<br>\\nWinner of the Platinum Grand Prize during the 2014 Future Film Festival, held in Italy.","coverImage":"https:\\/\\/s4.anilist.co\\/file\\/anilistcdn\\/media\\/anime\\/cover\\/small\\/17677.jpg","format":"MOVIE","episodes":1,"episodeDuration":25,"status":"FINISHED","startDate":"2013-07-20T00:00:00","endDate":"2013-07-20T00:00:00","season":"SUMMER 2013","averageScore":64,"source":null,"hashtag":null,"anilistId":null,"malId":null,"studioId":null,"studio":null,"episodesThreadId":null,"episodesThread":null,"reviewsThreadId":null,"reviewsThread":null,"animeCharacters":null,"characters":null,"animeGenres":null,"animeLists":null,"animeStaffs":null,"animeTags":null},{"animeId":7810,"romajiTitle":"Yami wo Mitsumeru Hane","japaneseTitle":"\\u95c7\\u3092\\u898b\\u3064\\u3081\\u308b\\u7fbd\\u6839","englishTitle":"A Feather Stare at the Dark","description":"A story set in a world before ours. A world in chaos where forces of good and evil fight and mingle. By doing so, it creates the chance to give birth to the new world. <br><br>\\nA couple of winged beings make love and fly away. They bear a child in an egg, and when the child opens its eyes they are immediately destroyed, one consumed by fire and the other by water. <br><br>\\nMythical, elemental and mysterious, the world created by Tsuji is dangerous, menacing and suffuse with signs of apocalypse, but somehow simultaneously tender and compassionate. A Feather Stare at the Dark captures simple gestures and primal feelings and amplifies them, realising the non-verbal and non-literal with remarkable grace. ","coverImage":"https:\\/\\/s4.anilist.co\\/file\\/anilistcdn\\/media\\/anime\\/cover\\/small\\/7810.jpg","format":"MOVIE","episodes":1,"episodeDuration":17,"status":"FINISHED","startDate":null,"endDate":null,"season":null,"averageScore":0,"source":null,"hashtag":null,"anilistId":null,"malId":null,"studioId":null,"studio":null,"episodesThreadId":null,"episodesThread":null,"reviewsThreadId":null,"reviewsThread":null,"animeCharacters":null,"characters":null,"animeGenres":null,"animeLists":null,"animeStaffs":null,"animeTags":null},{"animeId":102634,"romajiTitle":"Natsu no Shisen 1942","japaneseTitle":"\\u590f\\u306e\\u8996\\u7dda\\u20101942","englishTitle":"A Gaze in Summer 1942","description":"Film by Tanaami Keiichi.","coverImage":"https:\\/\\/s4.anilist.co\\/file\\/anilistcdn\\/media\\/anime\\/cover\\/small\\/102634-nJ2Lf2evo6HJ.jpg","format":"MOVIE","episodes":1,"episodeDuration":4,"status":"FINISHED","startDate":null,"endDate":null,"season":null,"averageScore":0,"source":null,"hashtag":null,"anilistId":null,"malId":null,"studioId":null,"studio":null,"episodesThreadId":null,"episodesThread":null,"reviewsThreadId":null,"reviewsThread":null,"animeCharacters":null,"characters":null,"animeGenres":null,"animeLists":null,"animeStaffs":null,"animeTags":null},{"animeId":17827,"romajiTitle":"Daitoshokan no Hitsujikai","japaneseTitle":"\\u5927\\u56f3\\u66f8\\u9928\\u306e\\u7f8a\\u98fc\\u3044","englishTitle":"A Good Librarian Like a Good Shepherd","description":"The story is set at Shiomi Academy, a vast, prestigious academy with a Daitoshokan (literally, \\\\\\"great library\\\\\\") that rivals Japan\'s national library. As a member of the Library Club, Kyoutarou Kakei goes to Daitoshokan to enjoy reading by himself. He then meets a second-year girl named Tsugumi Shirasaki through the efforts of a so-called \\\\\\"shepherd\\\\\\" who fulfills people\'s wishes. Eventually, more girls join the club thanks to the \\\\\\"shepherd.\\\\\\"<br><br>\\r\\n(Source: ANN)","coverImage":"https:\\/\\/s4.anilist.co\\/file\\/anilistcdn\\/media\\/anime\\/cover\\/small\\/17827.jpg","format":"TV","episodes":12,"episodeDuration":24,"status":"FINISHED","startDate":"2014-10-09T00:00:00","endDate":"2014-12-25T00:00:00","season":"FALL 2014","averageScore":65,"source":"VISUAL_NOVEL","hashtag":"#daitoanime","anilistId":17827,"malId":17827,"studioId":346,"studio":null,"episodesThreadId":null,"episodesThread":null,"reviewsThreadId":null,"reviewsThread":null,"animeCharacters":null,"characters":null,"animeGenres":null,"animeLists":null,"animeStaffs":null,"animeTags":null},{"animeId":20902,"romajiTitle":"Daitoshokan no Hitsujikai Picture Drama","japaneseTitle":"\\u5927\\u56f3\\u66f8\\u9928\\u306e\\u7f8a\\u98fc\\u3044 \\u524d\\u591c\\u796d","englishTitle":"A Good Librarian Like a Good Shepherd Picture Drama","description":"Picture Drama episodes bundled with the Blu-ray\\/DVD Volumes.","coverImage":"https:\\/\\/s4.anilist.co\\/file\\/anilistcdn\\/media\\/anime\\/cover\\/small\\/20902.jpg","format":"SPECIAL","episodes":6,"episodeDuration":9,"status":"FINISHED","startDate":"2014-12-25T00:00:00","endDate":"2015-05-28T00:00:00","season":"WINTER 2015","averageScore":56,"source":"VISUAL_NOVEL","hashtag":null,"anilistId":null,"malId":null,"studioId":null,"studio":null,"episodesThreadId":null,"episodesThread":null,"reviewsThreadId":null,"reviewsThread":null,"animeCharacters":null,"characters":null,"animeGenres":null,"animeLists":null,"animeStaffs":null,"animeTags":null}]}';
  function test() {
    var anime = JSON.parse(temp);
    for (i = 0; i < anime.animes.length; i++) {
      $("#test").append("<p>" + anime.animes[i].romajiTitle + "</p>");
    }
  }
  function sleep(milliseconds) {
    const date = Date.now();
    let currentDate = null;
    do {
      currentDate = Date.now();
    } while (currentDate - date < milliseconds);
  }

  //setup before functions
  var typingTimer; //timer identifier
  var doneTypingInterval = 500; //time in ms, 5 second for example
  var $input = $("#searchBox");

  //on keyup, start the countdown
  $input.on("keyup", function () {
    clearTimeout(typingTimer);
    typingTimer = setTimeout(doneTyping, doneTypingInterval);
  });

  //on keydown, clear the countdown
  $input.on("keydown", function () {
    clearTimeout(typingTimer);
  });

  //user is "finished typing," do something
  function doneTyping() {
    //do something
    var input, filter, ul, li, a, i;

    input = document.getElementById("searchBox");

    filter = input.value.toUpperCase();

    //promazávání výsledků
    $(".search-anime").empty();
    $(".search-manga").empty();
    $(".search-studio").empty();

    //pokud není nic napsáno nic se nezobrazý
    if (filter == "") {
      return;
    }

    var animePath = 'https://localhost:5001/API/GET/ANIME/FIND?name='+filter;
    // var animePath = 'https://172.21.0.13:5001/API/GET/ANIME/FIND?name='+filter;
    // var animePath = 'https://90.176.72.74:5001/API/GET/ANIME/FIND?name='+filter;
    $.getJSON(animePath, function(data) {
      var anime = data;
      for (i = 0; i < anime.length; i++) {
        txtValue = anime[i].romajiTitle;
        if (txtValue.toUpperCase().indexOf(filter) > -1) {
          //a[i].style.display = "";
          //$(".search-anime").append(anime.animes[i].romajiTitle + "<br>");
          $(".search-anime").append(
              "<a href='/Anime/Details/" + anime[i].animeId + "' class='result z2'><img src='" +
              anime[i].coverImage +
              "' alt='coverIMG'/><div class='text'><p>" +
              anime[i].romajiTitle +
              "</p><p>" +
              anime[i].startDate.substring(0,4) +
              " " +
              anime[i].format +
              " " +
              anime[i].averageScore +
              "%</p></div></a>"
          );
        } else {
          // a[i].style.display = "none";
        }
      }
    });

    var mangaPath = 'https://localhost:5001/API/GET/MANGA/FIND?name='+filter;
    // var mangaPath = 'https://172.21.0.13:5001/API/GET/MANGA/FIND?name='+filter;
    // var mangaPath = 'https://90.176.72.74:5001/API/GET/MANGA/FIND?name='+filter;
    $.getJSON(mangaPath, function(data) {
      var manga = data;
      for (i = 0; i < manga.length; i++) {
        txtValue = manga[i].romajiTitle;
        if (txtValue.toUpperCase().indexOf(filter) > -1) {
          var date = "";
          var score = "";
          if (manga[i].startDate !== null){
            date = manga[i].startDate;
          }
          if (manga[i].score !== null){
            score = manga[i].startDate + "%";
          }
          $(".search-manga").append(
              "<a href='/Manga/Details/" + manga[i].mangaId + "' class='result z2'><img src='" +
              manga[i].img +
              "' alt='coverIMG'/><div class='text'><p>" +
              manga[i].romajiTitle +
              "</p><p>" +
              date +
              " " +
              manga[i].format +
              " " +
              score +
              "</p></div></a>"
          );
        } else {
          // a[i].style.display = "none";
        }
      }
    });

    var studioPath = 'https://localhost:5001/API/GET/STUDIO/FIND?name='+filter;
    // var studioPath = 'https://172.21.0.13:5001/API/GET/STUDIO/FIND?name='+filter;
    $.getJSON(studioPath, function(data) {
      var studio = data;
      for (i = 0; i < studio.length; i++) {
        txtValue = studio[i].name;
        if (txtValue.toUpperCase().indexOf(filter) > -1) {
          $(".search-studio").append(
              "<a href='/Studios/Details/" + studio[i].studioId + "' class='result z2'><div class='text'><p>" +
              studio[i].name
          );
        } else {
          // a[i].style.display = "none";
        }
      }
    });
    
    
    
    

    
    // var anime = JSON.parse(temp);
    // for (i = 0; i < anime.animes.length; i++) {
    //   txtValue = anime.animes[i].romajiTitle;
    //   if (txtValue.toUpperCase().indexOf(filter) > -1) {
    //     //a[i].style.display = "";
    //     //$(".search-anime").append(anime.animes[i].romajiTitle + "<br>");
    //     $(".search-anime").append(
    //         "<a href='#' class='result z2'><img src='" +
    //         anime.animes[i].coverImage +
    //         "' alt='coverIMG'/><div class='text'><p>" +
    //         anime.animes[i].romajiTitle +
    //         "</p><p>" +
    //         anime.animes[i].startDate +
    //         " " +
    //         anime.animes[i].format +
    //         " " +
    //         anime.animes[i].averageScore +
    //         "%</p></div></a>"
    //     );
    //     $(".search-manga").append(
    //       "<a href='#' class='result z2'><img src='" +
    //         anime.animes[i].coverImage +
    //         "' alt='coverIMG'/><div class='text'><p>" +
    //         anime.animes[i].romajiTitle +
    //         "</p><p>" +
    //         anime.animes[i].startDate +
    //         " " +
    //         anime.animes[i].format +
    //         " " +
    //         anime.animes[i].averageScore +
    //         "%</p></div></a>"
    //     );
    //     $(".search-studio").append(
    //       "<a href='#' class='result z2'><img src='" +
    //         anime.animes[i].coverImage +
    //         "' alt='coverIMG'/><div class='text'><p>" +
    //         anime.animes[i].romajiTitle +
    //         "</p><p>" +
    //         anime.animes[i].startDate +
    //         " " +
    //         anime.animes[i].format +
    //         " " +
    //         anime.animes[i].averageScore +
    //         "%</p></div></a>"
    //     );
    //   } else {
    //     // a[i].style.display = "none";
    //   }
    // }
  }
});
